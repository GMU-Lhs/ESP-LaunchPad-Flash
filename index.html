<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ESP32-C3 USB 在线烧录</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="
  font-family: Arial, Helvetica, sans-serif;
  text-align: center;
  padding-top: 50px;
  background-color: #f7f7f7;
">

  <h2>ESP32-C3 USB 在线烧录</h2>

  <p>
    请使用 <b>Chrome / Edge</b> 浏览器<br>
    使用 <b>USB 数据线</b> 连接 ESP32-C3
  </p>

  <!-- ESP Launchpad 跳转入口 -->
  <a
    href="https://esp.eterill.xyz/?flashConfigURL=https://GMU-lhs.github.io/ESP-LaunchPad-Flash/config.toml"
  >
    <img
      src="https://esp.eterill.xyz/assets/try_with_launchpad.png"
      width="260"
      alt="ESP Launchpad 一键烧录"
    >
  </a>

  <p style="margin-top: 30px; color: #666; font-size: 14px;">
    点击按钮后，选择 USB 设备即可开始烧录<br>
    无需安装任何软件
  </p>

</body>
</html>
<hr style="margin:40px auto; max-width:600px;">

<h3>ESP32-C3 USB 串口通信</h3>
<p style="color:#666;font-size:14px;">
  烧录完成后，点击下方按钮连接 ESP32-C3 串口
</p>

<div style="max-width:720px;margin:0 auto;background:#fff;padding:16px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);">

  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px;">
    <button id="connect">连接串口</button>
    <button id="disconnect" disabled>断开</button>
    <button id="clear">清屏</button>

    <select id="baud" style="margin-left:auto;">
      <option value="115200">115200</option>
      <option value="921600">921600</option>
      <option value="9600">9600</option>
    </select>
  </div>

  <pre id="log" style="height:260px;overflow:auto;background:#0d1117;color:#d1e7ff;padding:10px;border-radius:8px;"></pre>

  <div style="display:flex;gap:10px;margin-top:10px;">
    <input id="input" placeholder="输入内容，回车发送" style="flex:1;padding:8px;">
    <button id="send" disabled>发送</button>
  </div>
</div>

<script>
let port, reader, writer;
const log = s => {
  const el = document.getElementById("log");
  el.textContent += s;
  el.scrollTop = el.scrollHeight;
};

document.getElementById("connect").onclick = async () => {
  if (!navigator.serial) {
    alert("请使用 Chrome / Edge 桌面浏览器");
    return;
  }
  port = await navigator.serial.requestPort();
  await port.open({ baudRate: +baud.value });

  writer = port.writable.getWriter();
  const decoder = new TextDecoderStream();
  port.readable.pipeTo(decoder.writable);
  reader = decoder.readable.getReader();

  log("[已连接串口]\n");
  send.disabled = false;
  disconnect.disabled = false;
  connect.disabled = true;

  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    if (value) log(value);
  }
};

disconnect.onclick = async () => {
  await reader?.cancel();
  await writer?.releaseLock();
  await port?.close();
  log("[已断开]\n");
  send.disabled = true;
  disconnect.disabled = true;
  connect.disabled = false;
};

send.onclick = async () => {
  const text = input.value + "\n";
  input.value = "";
  await writer.write(new TextEncoder().encode(text));
};

input.onkeydown = e => {
  if (e.key === "Enter") send.onclick();
};

clear.onclick = () => log("");
</script>

